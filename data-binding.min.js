var Model;!function(){"use strict";Model=function(e,t){var n=this;this.bind={types:{html:function(e,t){t.innerHTML=n.value.get(e)},text:function(e,t){t.innerText=n.value.get(e)},value:function(e,t){if("INPUT"===t.nodeName){var r="input";"checkbox"===t.type&&(r="change"),t.value=n.value.get(e),t.addEventListener(r,function(){n.value.set(e,this.value)})}else console.error("syntax error:","element bound with value type must be input",t)},event:function(t,r,o){var i=o.match(/\(.*?\)/)[0].replace(/\(/,"").replace(/\)/,""),a=e[t.replace(/\(.*?\)/,"")],u=n.value.params(t);if(u)for(var c=0;c<u.length;c++)u[c]=n.value.get(u[c]);"function"==typeof a?r.addEventListener(i,function(e){var t=[e];u&&u.forEach(function(e){t.push(e)}),a.apply(void 0,t)}):console.error("syntex error:","value bound to event type must be function",r)},attr:function(e,t,r){var o=r.match(/\(.*?\)/)[0].replace(/\(/,"").replace(/\)/,""),i=n.value.get(e);"object"==typeof i?t.setAttribute(o,JSON.stringify(i)):t.setAttribute(o,i)},repeat:function(t,r){var o=e[t],i=document.createElement("div");Array.isArray(o)?(r._template||(r._template=r.innerHTML),i.innerHTML=r._template,r.innerHTML="",o.forEach(function(t,o){var a,u,c=i.cloneNode();for(c.innerHTML=i.innerHTML,a=c.querySelectorAll("*[bind]"),e.$item=t,e.$index=o,u=0;u<a.length;u++)n.bind.element(a[u]);for(u=0;u<c.childNodes.length;u++){var l=c.childNodes[u];"#text"!==l.nodeName&&r.appendChild(l)}})):console.error("syntex error: value bound to repeat type must be array",r)},"if":function(e,t){var r,o=!1;null!==e.match(/^!/)&&(o=!0,e=e.replace(/^!/,"")),r=n.value.get(e),"boolean"==typeof r?(o&&(r=!r),r?t.removeAttribute("hidden"):t.setAttribute("hidden","")):console.error("syntax error: value bound to if type must be boolean",t)}},element:function(e){var t=e.getAttribute("bind").replace(/\s/g,"").split("|");t.forEach(function(t){t=t.split("=>");var r=t[0],o=t[1];o?n.bind.types[o.match(/^\w+/)](r,e,o):console.error("syntax error:","property and type must be set",e)})}},this.value={object:function(t){var n=t.split("."),r=e[n[0]];for(n.splice(0,1);0!==n.length;)r=r[n[0]],n.splice(0,1);return r},"function":function(t,r){var o=n.value.params(t),i=[];return o&&o.forEach(function(e){i.push(n.value.get(e))}),e[r].apply(void 0,i)},params:function(e){var t=e.match(/\(.*?\)/);return t?t=t[0].replace(/\(/,"").replace(/\)/,"").replace(/\s/g,"").split(","):void 0},get:function(t){var r=t.replace(/\(.*?\)/,"");return e[r]?"function"==typeof e[r]?n.value["function"](t,r):e[r]:n.value.object(t)},set:function(t,n){if(void 0===e[t]){var r=t.split("."),o=e[r[0]];for(r.splice(0,1);1!==r.length;)o=o[r[0]],r.splice(0,1);o[r[0]]=n}else e[t]=n}},this.getUses=function(e){for(var t={},r=0;r<e.length;r++){var o=e[r].getAttribute("bind").split("=>")[0].replace(/^!/,"");if(t[o])t[o].pos.push(r);else if(null===o.match(/$item/)){t[o]={pos:[r]};var i=n.value.params(o);i&&i.forEach(function(e){t[e]?t[e].func?t[e].func.push(o):t[e].func=[o]:t[e]={func:[o]}})}}return t},this.observe=function(e,t,r,o){Object.observe(e,function(e){e.forEach(function(e){var i=(o?o:"")+e.name;i=i.replace(/\.\d+$/,""),null===i.match(/\.length$/,"")&&"$item"!==e.name&&"$index"!==e.name&&(t[i].pos&&t[i].pos.forEach(function(e){n.bind.element(r[e])}),t[i].func&&t[i].func.forEach(function(e){t[e].pos.forEach(function(e){n.bind.element(r[e])})}))})});for(var i in e)"object"==typeof e[i]&&"$item"!==i&&"$index"!==i&&n.observe(e[i],t,r,(o?o:"")+i+".")},this.init=function(){t||(t=document.body);var r=t.querySelectorAll("*[bind]"),o=n.getUses(r);n.observe(e,o,r);for(var i=0;i<r.length;i++)null===r[i].getAttribute("bind").match(/\$item/)&&n.bind.element(r[i])},this.init()}}();
